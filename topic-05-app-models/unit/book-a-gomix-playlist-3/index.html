<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css"
          type="text/css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/railscasts.min.css"
          rel="stylesheet"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <style>
      

body {
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
  font-size:90%;
  color: black;
}

p {
  margin: 0.5em;
}

pre code {
  font-family: "Monaco";
  font-size: 100%;
}

img {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  margin:10px;
}

h1, h2, h3 {
  border-bottom:thin solid black;
  margin-bottom: 0.5em;
  margin-top: 1em;
}

h1 {
  font-style:italic;
  font-size:130%;
}

h2 {
  font-size:110%;
}

h3 {
  font-size:100%;
}



      

html, body {
  height: 100%;
  margin: 0;
}
.wrapper {
  height: 100%;
  display: flex;
  flex-direction: column;
}
.footer {
  background: white;
  text-align: right;
}
.content {
  flex: 1;
  overflow: auto;
}



    </style>
  </head>

  
  

  <div class="ui fixed top pointing inverted stackable menu labmenu">
    <header class="header item">
      <i id="toc" class="sitemap icon"></i>
      
        <a href="../../index.html"> Forms  </a>
      
    </header>
    <div class="right tab-menu menu">
      
        <a class="item" data-tab="Lab-6 Playlist 3">
          Lab-6 Playlist 3
        </a>
      
        <a class="item" data-tab="Exercise Solutions">
          Exercise Solutions
        </a>
      
        <a class="item" data-tab="01">
          01
        </a>
      
        <a class="item" data-tab="02">
          02
        </a>
      
        <a class="item" data-tab="03">
          03
        </a>
      
        <a class="item" data-tab="04">
          04
        </a>
      
        <a class="item" data-tab="Exercises">
          Exercises
        </a>
      
    </div>
  </div>


  

  <div class="ui pushable">
    <div class="ui inverted labeled icon left inline vertical sidebar menu">
      <br><br>
      
        
          
            <a class="item"
               href="https://wit-hdip-comp-sci-2019.github.io/ictskills-1//topic-00-module-overview/unit-1/book-a-glitch-intro/index.html">Lab-1 Glitch Intro </a>
          
        
      
        
          
            <a class="item"
               href="https://wit-hdip-comp-sci-2019.github.io/ictskills-1//topic-01-js-intro/unit-1/book-b-js-introduction/index.html">Lab-2 JS Intro </a>
          
        
      
        
          
            <a class="item"
               href="https://wit-hdip-comp-sci-2019.github.io/ictskills-1//topic-02-arrays/unit-1/book-a-js-arrays/index.html">Lab-3 JS Arrays </a>
          
        
      
        
          
            <a class="item"
               href="https://wit-hdip-comp-sci-2019.github.io/ictskills-1//topic-03-web-apps/unit-2/book-a-glitch-playlist-1/index.html">Lab-4 Playlist 1 </a>
          
        
      
        
          
            <a class="item"
               href="https://wit-hdip-comp-sci-2019.github.io/ictskills-1//topic-04-app-templates+views/unit-1/book-a-playlist-2/index.html">Lab-5 Playlist 2 </a>
          
        
      
        
          
            <a class="item"
               href="https://wit-hdip-comp-sci-2019.github.io/ictskills-1//topic-05-app-models/unit/book-a-gomix-playlist-3/index.html">Lab-6 Playlist 3 </a>
          
        
      
    </div>
    <div class="pusher" tabindex="-1">
      <div class="ui basic segment">
        <br>
        
          <div class="ui tab segment lab" data-tab="Lab-6 Playlist 3">
            <h1>Objectives</h1>
<p>Enable Songs and Playlists to be added via simple forms.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="Exercise Solutions">
            <h1>Exercise Solutions</h1>
<p>his lab requires that the <code>playlist-1</code> lab be completed. If you have lost your solution, create a new project in Glitch by cloning this repo:</p>
<ul>
<li><a href="https://github.com/wit-hdip-comp-sci-2019/playlist-2">https://github.com/wit-hdip-comp-sci-2019/playlist-2</a></li>
</ul>
<p>Instructions on how to do this are <a href="https://wit-hdip-comp-sci-2019.github.io/ictskills-1//topic-03-web-apps/unit-2/book-a-glitch-playlist-1/index.html#/01">here</a>. Remember to use the url above.</p>
<p>These are the exercises from the last lab:</p>
<h2>Exercise 1: UX Enhancements &amp; Exercise 3: listplaylists partial</h2>
<p>Introduce a &#39;Delete Playlist&#39; button for each playlist, represented by a <code>trash</code> icon.</p>
<p>First, create a new partial:</p>
<h2>views/partials/listplaylists.hbs</h2>
<pre><code class="lang-html">{{#each playlists}}
  &lt;section class=&quot;ui stacked segment&quot;&gt;
    &lt;h2 class=&quot;ui header&quot;&gt;
      {{title}}
    &lt;/h2&gt;
    &lt;p&gt; Total Duration: {{duration}} &lt;/p&gt;
    &lt;a href=&quot;/playlist/{{id}}&quot; class=&quot;ui icon button&quot;&gt;
      &lt;i class=&quot;icon folder open&quot;&gt;&lt;/i&gt;
    &lt;/a&gt;
    &lt;a href=&quot;/dashboard/deleteplaylist/{{id}}&quot; class=&quot;ui icon button&quot;&gt;
      &lt;i class=&quot;icon trash&quot;&gt;&lt;/i&gt;
    &lt;/a&gt;
  &lt;/section&gt;
{{/each}}</code></pre>
<p>Now we can refactor the dashboard partial to use this:</p>
<h2>views/dashboard.hbs</h2>
<pre><code class="lang-html">{{&gt; menu id=&quot;dashboard&quot;}}

&lt;section class=&quot;ui segment&quot;&gt;
  {{&gt; listplaylists}}
&lt;/section&gt;</code></pre>
<p>The UI should look like this:</p>
<p><img src="img/07.png" alt=""></p>
<p>However, the delete (trash) button doesn&#39;t work yet (try it).</p>
<h2>Exercise 2: Delete Playlist Functionality</h2>
<p>Make the button actually delete the denoted playlist.</p>
<p>First, a route to delete the playlist:</p>
<h2>routes.js</h2>
<pre><code class="lang-js">...
router.get(&#39;/dashboard/deleteplaylist/:id&#39;, dashboard.deletePlaylist);
...</code></pre>
<p>Then the method to implement this route:</p>
<h2>controllers/dashboard.js</h2>
<pre><code class="lang-js">...
  deletePlaylist(request, response) {
    const playlistId = request.params.id;
    logger.debug(`Deleting Playlist ${playlistId}`);
    playlistStore.removePlaylist(playlistId);
    response.redirect(&#39;/dashboard&#39;);
  },
...</code></pre>
<p>When introducing the new method above, you will need to separate the method from the existing index method with a comma - an syntax error will appear of you forget this. Here is the complete dashboard.js for reference:</p>
<pre><code>&quot;use strict&quot;;

const logger = require(&quot;../utils/logger&quot;);
const playlistStore = require(&quot;../models/playlist-store&quot;);

const playlist = {
  index(request, response) {
    const playlistId = request.params.id;
    logger.debug(&quot;Playlist id = &quot;, playlistId);
    const viewData = {
      title: &quot;Playlist&quot;,
      playlist: playlistStore.getPlaylist(playlistId)
    };
    response.render(&quot;playlist&quot;, viewData);
  },

  deleteSong(request, response) {
    const playlistId = request.params.id;
    const songId = request.params.songid;
    logger.debug(`Deleting Song ${songId} from Playlist ${playlistId}`);
    playlistStore.removeSong(playlistId, songId);
    response.redirect(&quot;/playlist/&quot; + playlistId);
  }
};

module.exports = playlist;</code></pre>
<p>Finally, we need a new method on playlist-store to delete the playlist form the model:</p>
<h2>models/playlist-store.js</h2>
<pre><code class="lang-js">  removePlaylist(id) {
    _.remove(this.playlistCollection, { id: id });
  },</code></pre>
<p>Again, a comma may be needed. This is the complete playlist-store at this stage:</p>
<pre><code>&quot;use strict&quot;;

const _ = require(&quot;lodash&quot;);

const playlistStore = {
  playlistCollection: require(&quot;./playlist-store.json&quot;).playlistCollection,

  getAllPlaylists() {
    return this.playlistCollection;
  },

  getPlaylist(id) {
    return _.find(this.playlistCollection, { id: id });
  },

  removeSong(id, songId) {
    const playlist = this.getPlaylist(id);
    _.remove(playlist.songs, { id: songId });
  },

  removePlaylist(id) {
    _.remove(this.playlistCollection, { id: id });
  },
};

module.exports = playlistStore;</code></pre>
<p>Verify now that you can delete playlists.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="01">
            <h1>Adding a Song</h1>
<p>Before adding a song, lets align the delete button appearance with the delete playlist. Use this icon button instead of the existing one:</p>
<h2>views/partials/listsongs.hbs</h2>
<pre><code class="lang-html">          &lt;a href=&quot;/playlist/{{../playlist.id}}/deletesong/{{id}}&quot; class=&quot;ui icon button&quot;&gt;
            &lt;i class=&quot;icon trash&quot;&gt;&lt;/i&gt;
          &lt;/a&gt;</code></pre>
<p>This is the complete listsongs partial now:</p>
<pre><code>&lt;table class=&quot;ui table&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Song&lt;/th&gt;
      &lt;th&gt;Artist&lt;/th&gt;
      &lt;th&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    {{#each playlist.songs}}
      &lt;tr&gt;
        &lt;td&gt;
          {{title}}
        &lt;/td&gt;
        &lt;td&gt;
          {{artist}}
        &lt;/td&gt;
        &lt;td&gt;
          &lt;a href=&quot;/playlist/{{../playlist.id}}/deletesong/{{id}}&quot; class=&quot;ui icon button&quot;&gt;
            &lt;i class=&quot;icon trash&quot;&gt;&lt;/i&gt;
          &lt;/a&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    {{/each}}
  &lt;/tbody&gt;
&lt;/table&gt;</code></pre>
<p>In order to add songs, we need this new partial which provides a simple add song form. Introduce this new partial now:</p>
<h2>views/partials/addsong.hbs</h2>
<pre><code class="lang-html">&lt;form class=&quot;ui stacked segment form&quot; action=&quot;/playlist/{{playlist.id}}/addsong&quot; method=&quot;POST&quot;&gt;
  &lt;div class=&quot;two fields&quot;&gt;
    &lt;div class=&quot;field&quot;&gt;
      &lt;label&gt;Title&lt;/label&gt;
      &lt;input placeholder=&quot;Title&quot; type=&quot;text&quot; name=&quot;title&quot;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;field&quot;&gt;
      &lt;label&gt;Artist&lt;/label&gt;
      &lt;input placeholder=&quot;Artist&quot; type=&quot;text&quot; name=&quot;artist&quot;&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;button class=&quot;ui blue submit button&quot;&gt;Add Song&lt;/button&gt;
&lt;/form&gt;</code></pre>
<p>We need to incorporate this in the playlist view:</p>
<h2>views/playlist.hbs</h2>
<pre><code>{{&gt; menu}}

&lt;section class=&quot;ui center aligned middle aligned segment&quot;&gt;
  &lt;h2 class=&quot;ui header&quot;&gt;
    {{playlist.title}}
  &lt;/h2&gt;
  {{&gt; listsongs}}
  {{&gt; addsong}}
&lt;/section&gt;</code></pre>
<p>This should now appear at then end of each playlist:</p>
<p><img src="img/01.png" alt=""></p>
<p>Now we meed a new route to support the form we have just added:</p>
<h2>routes.js</h2>
<pre><code class="lang-js">...
router.post(&#39;/playlist/:id/addsong&#39;, playlist.addSong);
...</code></pre>
<p>... and this new function in the <code>playlist</code> controller:</p>
<h2>controllers/playlist.js</h2>
<pre><code class="lang-js">...
  addSong(request, response) {
    const playlistId = request.params.id;
    const playlist = playlistStore.getPlaylist(playlistId);
    const newSong = {
      title: request.body.title,
      artist: request.body.artist,
    };
    playlistStore.addSong(playlistId, newSong);
    response.redirect(&#39;/playlist/&#39; + playlistId);
  },
...</code></pre>
<p>This is the complete playlist controller now:</p>
<pre><code>&quot;use strict&quot;;

const logger = require(&quot;../utils/logger&quot;);
const playlistStore = require(&quot;../models/playlist-store&quot;);

const playlist = {
  index(request, response) {
    const playlistId = request.params.id;
    logger.debug(&quot;Playlist id = &quot;, playlistId);
    const viewData = {
      title: &quot;Playlist&quot;,
      playlist: playlistStore.getPlaylist(playlistId)
    };
    response.render(&quot;playlist&quot;, viewData);
  },

  deleteSong(request, response) {
    const playlistId = request.params.id;
    const songId = request.params.songid;
    logger.debug(`Deleting Song ${songId} from Playlist ${playlistId}`);
    playlistStore.removeSong(playlistId, songId);
    response.redirect(&quot;/playlist/&quot; + playlistId);
  },

  addSong(request, response) {
    const playlistId = request.params.id;
    const playlist = playlistStore.getPlaylist(playlistId);
    const newSong = {
      title: request.body.title,
      artist: request.body.artist,
    };
    playlistStore.addSong(playlistId, newSong);
    response.redirect(&#39;/playlist/&#39; + playlistId);
  },
};

module.exports = playlist;</code></pre>
<p>Finally, we need to implement a new  <code>addSong</code> method in the playlist-store:</p>
<h2>modiels/playlist-store.js</h2>
<pre><code class="lang-js">  addSong(id, song) {
    const playlist = this.getPlaylist(id);
    playlist.songs.push(song);
  },</code></pre>
<p>This is the complete playlist-store:</p>
<pre><code>&quot;use strict&quot;;

const _ = require(&quot;lodash&quot;);

const playlistStore = {
  playlistCollection: require(&quot;./playlist-store.json&quot;).playlistCollection,

  getAllPlaylists() {
    return this.playlistCollection;
  },

  getPlaylist(id) {
    return _.find(this.playlistCollection, { id: id });
  },

  removeSong(id, songId) {
    const playlist = this.getPlaylist(id);
    _.remove(playlist.songs, { id: songId });
  },

  removePlaylist(id) {
    _.remove(this.playlistCollection, { id: id });
  },

  addSong(id, song) {
    const playlist = this.getPlaylist(id);
    playlist.songs.push(song);
  },
};

module.exports = playlistStore;</code></pre>
<p>Try the app  now and verify that you can add songs.</p>
<p>Think about the following at this stage:</p>
<ul>
<li>Can you delete one of the songs you have just added? </li>
<li>Can you delete one of the songs that have been in there already? </li>
</ul>
<p>What might be happening in the above? (see next step to explore further).</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="02">
            <h1>ID Management</h1>
<p>Deleting a song you have manually added using the form generates the following:</p>
<pre><code>Cannot GET /playlist/02/deletesong/</code></pre>
<p>However, pre-populated songs can still be deleted. What is going on here?</p>
<p>The issue is that the new songs we have added do not appear to have IDs. Looking at this list for instance:</p>
<p><img src="img/02.png" alt=""></p>
<p>In the browser, right-click and select &#39;view source&#39; and you should see something like this:</p>
<p><img src="img/03.png" alt=""></p>
<p>Look at the last entry - there is no ID for the new song we added.</p>
<p>Here is our <code>addsong</code> function again:</p>
<h2>controlers/playlist.js</h2>
<pre><code class="lang-js">  addSong(request, response) {
    const playlistId = request.params.id;
    const playlist = playlistStore.getPlaylist(playlistId);
    const newSong = {
      title: request.body.title,
      artist: request.body.artist,
    };
    playlistStore.addSong(playlistId, newSong);
    response.redirect(&#39;/playlist/&#39; + playlistId);
  },</code></pre>
<p>The object we are inserting has only two fields:</p>
<pre><code class="lang-js">    const newSong = {
      title: request.body.title,
      artist: request.body.artist,
    };</code></pre>
<p>We need to also insert a new, unique, ID for each object we create.</p>
<p>How do we create a new ID? This can be challenged in implement manually. However, one solution is to use Universally Unique Identifiers:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">https://en.wikipedia.org/wiki/Universally_unique_identifier</a></li>
</ul>
<p>A library to generate a uuid is already in our app, we just need to import and use it</p>
<p>At the top of the <code>playlist</code> controller, we require the library. Insert this at the top of the modile:</p>
<h2>controllers/playlists.js</h2>
<pre><code>const uuid = require(&#39;uuid&#39;);</code></pre>
<p>Now, when we are creating a playlist, we can use the library to generate a unique id for us:</p>
<pre><code class="lang-js">  const newSong = {
    id: uuid(),
    title: request.body.title,
    artist: request.body.artist,
  };</code></pre>
<p>This is the complete playlist module at this stage:</p>
<pre><code>&quot;use strict&quot;;

const logger = require(&quot;../utils/logger&quot;);
const playlistStore = require(&quot;../models/playlist-store&quot;);
const uuid = require(&#39;uuid&#39;);

const playlist = {
  index(request, response) {
    const playlistId = request.params.id;
    logger.debug(&quot;Playlist id = &quot;, playlistId);
    const viewData = {
      title: &quot;Playlist&quot;,
      playlist: playlistStore.getPlaylist(playlistId)
    };
    response.render(&quot;playlist&quot;, viewData);
  },

  deleteSong(request, response) {
    const playlistId = request.params.id;
    const songId = request.params.songid;
    logger.debug(`Deleting Song ${songId} from Playlist ${playlistId}`);
    playlistStore.removeSong(playlistId, songId);
    response.redirect(&quot;/playlist/&quot; + playlistId);
  },

  addSong(request, response) {
    const playlistId = request.params.id;
    const playlist = playlistStore.getPlaylist(playlistId);
    const newSong = {
      id: uuid(),
      title: request.body.title,
      artist: request.body.artist,
    };
    playlistStore.addSong(playlistId, newSong);
    response.redirect(&#39;/playlist/&#39; + playlistId);
  },
};

module.exports = playlist;</code></pre>
<p>Try this now and make sure the new songs can be deleted. View the source to reveal the uuid-style ids in the new songs:</p>
<p><img src="img/08.png" alt=""></p>
<p>In addition, we can add a log statement so that we can see the songs as they are added:</p>
<pre><code>...
    logger.debug(&#39;New Song = &#39;, newSong);
...</code></pre>

          </div>
        
          <div class="ui tab segment lab" data-tab="03">
            <h1>Adding playlists</h1>
<p>Taking the last step as an example, we can quickly implement the necessary form, route, controller function and model update to support adding a new playlist (as opposed to a song).</p>
<p>This is a new addplaylist partial:</p>
<h2>views/partials/addplaylist.hbs</h2>
<pre><code class="lang-html">&lt;form class=&quot;ui stacked segment form&quot; action=&quot;/dashboard/addplaylist&quot; method=&quot;POST&quot;&gt;
  &lt;div class=&quot;field&quot;&gt;
    &lt;label&gt;Title&lt;/label&gt;
    &lt;input placeholder=&quot;Title&quot; type=&quot;text&quot; name=&quot;title&quot;&gt;
  &lt;/div&gt;
  &lt;button class=&quot;ui blue submit button&quot;&gt;Add Playlist&lt;/button&gt;
&lt;/form&gt;</code></pre>
<p>Modify dashboard to append this partial:</p>
<h2>views/dashboard.hbs</h2>
<pre><code class="lang-html">{{&gt; menu id=&quot;dashboard&quot;}}

&lt;section class=&quot;ui segment&quot;&gt;
  {{&gt; listplaylists}}
  {{&gt; addplaylist}}
&lt;/section&gt;</code></pre>
<p>This now requires a new route:</p>
<h2>routes.js</h2>
<pre><code class="lang-js">router.post(&#39;/dashboard/addplaylist&#39;, dashboard.addPlaylist);</code></pre>
<p>.. and this is the new method on the dashboard controller:</p>
<h2>controllers/dashboard.js</h2>
<p>Import the uuid library at the top:</p>
<pre><code class="lang-js">const uuid = require(&#39;uuid&#39;);</code></pre>
<p>... and then this new method&quot;</p>
<pre><code>...
  addPlaylist(request, response) {
    const newPlayList = {
      id: uuid(),
      title: request.body.title,
      songs: [],
    };
    playlistStore.addPlaylist(newPlayList);
    response.redirect(&#39;/dashboard&#39;);
  },</code></pre>
<p>Notice we are again using the uuid library here to generate and ID for the new playlist.</p>
<p>Finally, a new method in the playlist-store to add a playlist:</p>
<h2>modes/playlist-store.js</h2>
<pre><code class="lang-js">addPlaylist(playlist) {
  this.playlistCollection.push(playlist);
},</code></pre>
<p>We should now be able to add new playlists.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="04">
            <h1>Persistence</h1>
<p>You will note that, even though we are able to add/delete playlists/songs, every time the app restarts then we are left with the same initial playlist. i.e. none of the changes we make are <code>persisted</code> beyond the life of the program execution.</p>
<p>This is the field of databases - and beyond the scope of this course for the moment. However, we can implement something like a database, but simpler, which can serve our needs. Introduce this new class into the project:</p>
<h2>models/json-store.js</h2>
<pre><code class="lang-js">&#39;use strict&#39;;

const low = require(&#39;lowdb&#39;);
const FileSync = require(&#39;lowdb/adapters/FileSync&#39;)

class JsonStore {
  constructor(file, defaults) {
    const adapter = new FileSync(file)
    this.db = low(adapter)
    this.db.defaults(defaults).value();
  }

  save() {
    this.db.write();
  }

  add(collection, obj) {
    this.db.get(collection).push(obj).last().value();
  }

  remove(collection, obj) {
    this.db.get(collection).remove(obj).value();
  }

  removeAll(collection) {
    this.db.get(collection).remove().value();
  }

  findAll(collection) {
    return this.db.get(collection).value();
  }

  findOneBy(collection, filter) {
    const results = this.db.get(collection).filter(filter).value();
    return results[0];
  }

  findByIds(collection, ids) {
    return this.db.get(collection).keyBy(&#39;id&#39;).at(ids).value();
  }

  findBy(collection, filter) {
    return this.db.get(collection).filter(filter).value();
  }
}

module.exports = JsonStore;</code></pre>
<p>This is a wrapper around this module:</p>
<ul>
<li><a href="https://github.com/typicode/lowdb">https://github.com/typicode/lowdb</a></li>
</ul>
<p>It will manage the json file we have been using, enabling updates in a convenient manner. You do not need to understand this module in depth for the moment, we will use another wrapper module to interact with it.</p>
<p>Here is the wraper, which is a new version of our playlist store module:</p>
<h2>modules/playlist-store.js</h2>
<pre><code class="lang-js">&#39;use strict&#39;;

const _ = require(&#39;lodash&#39;);
const JsonStore = require(&#39;./json-store&#39;);

const playlistStore = {

  store: new JsonStore(&#39;./models/playlist-store.json&#39;, { playlistCollection: [] }),
  collection: &#39;playlistCollection&#39;,

  getAllPlaylists() {
    return this.store.findAll(this.collection);
  },

  getPlaylist(id) {
    return this.store.findOneBy(this.collection, { id: id });
  },

  addPlaylist(playlist) {
    this.store.add(this.collection, playlist);
    this.store.save();
  },

  removePlaylist(id) {
    const playlist = this.getPlaylist(id);
    this.store.remove(this.collection, playlist);
    this.store.save();
  },

  removeAllPlaylists() {
    this.store.removeAll(this.collection);
    this.store.save();
  },

  addSong(id, song) {
    const playlist = this.getPlaylist(id);
    playlist.songs.push(song);
    this.store.save();
  },

  removeSong(id, songId) {
    const playlist = this.getPlaylist(id);
    const songs = playlist.songs;
    _.remove(songs, { id: songId});
    this.store.save();
  },
};

module.exports = playlistStore;</code></pre>
<p>No other changes are necessary - as all access to the playlist is via the above module.</p>
<p>The app should work now as before, except this time changes to the playlists will be <code>persisted</code> to the json file. This means that if the app has to be restarted, it will have preserved any changes to the playlist in the JSON file, which will be reloaded when the app restarts.</p>
<p>You can force a reload by deliberately introducing a syntax error - and then correcting it.</p>
<p>However, because of limitations in the way glitch is currently configured the playlist-store.json file will often not be in sync and not be updated at all. If you download and run the application locally (in webstorm), the json file will be updated accurately.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="Exercises">
            <h1>Exercises</h1>
<p>If you want to download a complete version of the app as it should be at the end of this lab, then create a new Glitch project, and clone this repo:</p>
<ul>
<li><a href="https://github.com/wit-hdip-comp-sci-2019/playlist-3">https://github.com/wit-hdip-comp-sci-2019/playlist-3</a></li>
</ul>
<p>You can also clone this repo directly, run &#39;npm install&#39; from inside the folder and then run from within Webstorm.</p>
<h2>Exercise 1: Display Durations</h2>
<p>Make sure the duration of each song and playlist is visible on the UX</p>
<p><img src="img/04.png" alt="">
<img src="img/05.png" alt=""></p>
<h2>Exercise 2: Add Song Duration</h2>
<p>Modify the add song form to accept a song duration as well as title and artist:</p>
<p><img src="img/06.png" alt=""></p>
<p>Make sure the duration is stored in the data store, and is displayed on the playlist view.</p>
<p>HINT: When reading a parameter from a form representing a number, you will need to convert it from string. The <code>Number</code> function is one simple way of doing this:</p>
<pre><code>    const newSong = {
      id: uuid(),
      title: request.body.title,
      artist: request.body.artist,
      duration: Number(request.body.duration),
    };</code></pre>
<h2>Exercise 3: Active Duration</h2>
<p>The durations in each playlist are just constants stored in the database. Currently, if you add a new playlist + songs, then the duration in the playlist will be undefined.</p>
<p>Change this now, such that when you add a song to a playlist the duration displayed on the dashboard for each playlist will be the actual sum of the donations for all songs in the playlist.</p>
<p>HINT: One way of dong this is to update the <code>addSong()</code> method in the <code>playlist-store</code> object:</p>
<pre><code>  addSong(id, song) {
    const playlist = this.getPlaylist(id);
    playlist.songs.push(song);

    let duration = 0;
    // Iterate over the playlist.songs array, and accumulate the duration of each
    // song into the duration local variable.
    // ...
    // ...

    // Now store the duration in playlist.store
    // ...

    this.store.save();
  },</code></pre>

          </div>
        
      </div>
    </div>
  </div>


  <br>
  <script>
    $(document).on('keydown', function(e) {
  e = e || window.event;
  var nextTab;
  switch (e.which || e.keyCode) {
    case 37: // left
      nextTab = $('.tab-menu a[data-tab].active').prev('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').last();
      nextTab.click();
      $('.pusher').focus();
      break;

    case 39: // right
      nextTab = $('.tab-menu a[data-tab].active').next('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').first();
      nextTab.click();
      $('.pusher').focus();
      break;
  }
});

    $(document).ready(function() {
  $('img').addClass('ui image');

  $('.ui.embed').embed();

  const $images = $('.lab img');
  jQuery.each($images, function(i) {
    if ($images[i].alt.length > 0) {
      const divImg = $(document.createElement('div')).addClass(
        'ui basic segment',
      );
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass(
        'ui blue ribbon label',
      );
      divLabel.append($images[i].alt);
      $(divLabel).insertBefore($images[i]);
    }
  });

  $('.ui.menu .item').tab({
    history: true,
    historyType: 'hash',
  });

  $('.popup').popup();

  $('.ui.sidebar')
    .sidebar({ context: $('.pushable') })
    .sidebar('setting', 'transition', 'slide out')
    .sidebar('attach events', '#toc');
});

  </script>



  <div class="ui bottom fixed borderless right menu">
    <div class="ui right small menu">
      <div class="ui tiny basic message segment">
         Powered by <a href="https://github.com/edeleastar/tutors-ts">tutors-ts.</a> 
      </div>
    </div>
  </div>

  </body>

</html>